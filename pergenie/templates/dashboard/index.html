{% extends "layout.html" %}
{% load extras %}
{% load staticfiles %}
{% block title %}Dashboard{% endblock %}
{% block description %}perGENIE dashboard{% endblock %}

{% block main_container %}
<div id="main_container" class="span10">
  <section id="main">
    <div class="container">

      <div class="content-box transparent">
        <div class="content-box-header">
          <i class="icon-wrench"></i> Components
        </div>
        <div class="row-fluid">
          <div class="span12">
            <div class="padded">
              <a href="{% url apps.riskreport.views.index %}">
              <button class="button square" href="#"{% ifequal intro_type.0 'risk_report' %} data-step="1" data-intro="{{ intros.0 }}" {% endifequal %}>
                <i class="icon-align-left icon-large"></i>
                <span class="button-text">RiskReport</span>
                {% if n_out_dated_riskreports > 0 %}<span class="badge badge-yellow">{{ n_out_dated_riskreports }}</span>{% endif %}
              </button>
              </a>

              <a href="{% url apps.traits.views.index %}">
              <button class="button square" href="#">
                <i class="icon-user icon-large"></i>
                <span class="button-text">Traits</span>
              </button></a>

              <button class="button square" href="#">
                <i class="icon-globe icon-large"></i>
                <span class="button-text">Population</span>
              </button>

              {% ifnotequal user.username demo_user_id %}
              <a href="{% url apps.upload.views.index %}">
              <button class="button square" href="#" {% ifequal intro_type.0 'first' %}data-step="1" data-intro="{{ intros.0 }}" {% endifequal %}>
                <i class="icon-arrow-up icon-large"></i>
                <span class="button-text">Upload</span>
              </button></a>
              {% else %}
              <!-- <a href="#"> -->
              <!-- <button class="button square disabled"> -->
              <!--   <i class="icon-arrow-up icon-large"></i> -->
              <!--   <span class="button-text">Upload</span> -->
              <!-- </button> -->
              <!-- </a> -->
              {% endifnotequal %}

              <a href="{% url apps.library.views.index %}">
              <button class="button square" href="#">
                <i class="icon-book icon-large"></i>
                <span class="button-text">Library</span>
              </button></a>

              <a href="{% url apps.faq.views.index %}">
                <button class="button square" href="#">
                  <i class="icon-question-sign icon-large"></i>
                  <span class="button-text">FAQ</span>
              </button></a>
            </div>
          </div>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span12">
          <div class="padded">
            <div class="content-box">
              <div class="content-box-header">
                <icon class="icon-exclamation-sign"></icon> Notifications
              </div>

              {% if msg %}
              <div class="alert alert-info">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>Information:</strong> {{ msg }}
              </div>
              {% endif %}

              {% if warns %}
              {% for warn in warns %}
              <div class="alert alert-warning">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>Warning!</strong> {{ warn }}
              </div>
              {% endfor %}
              {% endif %}

              {% if err %}
              <div class="alert alert-error">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>Error!</strong> {{ err }}
              </div>
              {% endif %}

            </div>
          </div>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span6">
          <div class="content-box">
            <div class="content-box-header">
              <icon class="icon-upload"></icon> Genome Statistics
            </div>

            <div class="tabbable">
              <ul class="nav nav-tabs">
                {% if infos %}
                {% for info in infos %}
                <li{% ifequal forloop.counter0|add:1 1 %} class="active"{% endifequal %}><a href="#tab{{ forloop.counter0|add:1 }}" data-toggle="tab">File {{ forloop.counter0|add:1 }}</a></li>
                {% endfor %}
                {% else %}
                <li class="active"><a href="#tab1" data-toggle="tab">File 1</a></li>
                {% endif %}
              </ul>

              <div class="tab-content">

                {% if infos %}
                {% for info in infos %}
                <div class="tab-pane{% ifequal forloop.counter0|add:1 1 %} active{% endifequal %}" id="tab{{ forloop.counter0|add:1 }}">
                  <div class="row-fluid">
                    <div class="span12 padded">
                      <p><b>File name</b>: {{ info.raw_name|limit:30 }}</p>
                      <table class="table table-bordered">
                        <tbody>

                          <tr>
                            <td class="center">
                              <p {% ifequal intro_type.0 'wait_upload' %}data-step="1" data-intro="{{ intros.0 }}" {% endifequal %}>Import status:</p>
                            </td>
                            <td class="center">
                              <div class="donut donut-big">
                                <div class="donut-arrow" data-percentage="{{ info.status }}"></div>
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <td class="center">
                              <p>What percentage does your genome file cover GWAS Cataog?</p>
                            </td>
                            <td class="center">
                              <div class="donut donut-big">
                                <div class="donut-arrow" data-percentage="{{ info.catalog_cover_rate }}"></div>
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <td class="center">
                              <p>What percentage does your genome file cover whole genome?</p>
                            </td>
                            <td class="center">
                              <div class="donut donut-big">
                                <div class="donut-arrow" data-percentage="{{ info.genome_cover_rate }}"></div>
                              </div>
                            </td>
                          </tr>
                      </table>
                    </div>
                  </div>
                </div>
              {% endfor %}
              </div>

              {% else %}
                <div class="tab-pane active" id="tab1">
                  <div class="row-fluid">
                    <div class="span12 padded">
                      <p><b>File name</b>:</p>
                      <table class="table table-bordered">
                        <tbody>
                          <tr>
                            <td class="center">
                              <p>Import status:</p>
                            </td>
                            <td class="center">
                              <div class="donut donut-big">
                                <div class="donut-arrow" data-percentage="0"></div>
                              </div>
                            </td>
                          </tr>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}

            </div>
          </div>
        </div>


        <div class="span6">
          <div class="content-box">
            <div class="content-box-header">
              <i class="icon-comments-alt"></i> Recently Added Studies
            </div>

            {% if recent_catalog_records %}
            <div class="row-fluid">
              <div class="span12">
                <ul class="latest-comments">
                  {% for record in recent_catalog_records %}
                  <li class="comment-box">
                    <!-- <div class="avatar user1 pull-left"></div> -->
                    <div class="article">
                      <div class="post-info"> {{ record.added|date }} </div>
                      <div class="post-content">
                        <table>
                          <tbody>
                            <tr>
                              <td>
                                <b>Trait: </b><a href="{% url apps.library.views.trait trait=record.trait %}">{{ record.trait }}</a>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <b>Study: </b>{{ record.study }} <span class="badge badge-yellow"><a href="{{ record.pubmed_link }}" target="_blank">Pubmed</a></span></td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </li>
                  {% endfor %}
                  <!-- <li class="comment-box view-more" style="text-align: center"> -->
                  <!--   <a href="#">View more...</a> -->
                  <!-- </li> -->
                </ul>
              </div>
            </div>
            {% endif %}

          </div>
        </div>

      </div>
    </div>
  </section>
</div>
{% endblock %}

{% block js %}
<link href="{% static 'css/introjs.css' %}" rel="stylesheet">
<script type="text/javascript" src="{% static 'js/intro.js' %}"></script>
<script type="text/javascript">introJs().start()</script>

<link href="{% static 'css/donuts.css' %}" rel="stylesheet">
<script src="{% static 'js/donuts.js' %}"></script>
{% endblock %}
