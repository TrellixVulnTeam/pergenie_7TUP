{% extends "layout.html" %}
{% block title %}MyGene{% endblock %}
{% block description %}MyGene{% endblock %}
{% load staticfiles %}
{% load extras %}

{% block main_container %}
<div id="main_container" class="span14">
  <section id="main">

    <div class="container">

      <div class="row-fluid">
        <div class="span12">
          <div class="content-box transparent">
            <div class="padded10">
              <h4>{{ gene_info.gene }}</h4>
            </div>
          </div>
        </div>
      </div>

      <!-- alerts -->
      {% if msg %}
      <div class="alert alert-info">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>Information:</strong> {{ msg }}
      </div>
      {% endif %}

      {% if err %}
      <div class="alert alert-error">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>Error!</strong> {{ err }}
      </div>
      {% endif %}

      <div class="row-fluid">
        <div class="span14">
          <div class="content-box">
            <div class="content-box-header">
              <icon class="icon-beaker"></icon>
            </div>

            <div class="padded">
              <div class="row-fluid">
                <div class="span14">
                  <p>TODO: chrom上のだいたいのpositonがわかるような染色体の図を入れる．</p>
                  <p>TODO: SNV・INSは赤系の色にする．</p>
                  <p>TODO: DELはグレーの赤にする．</p>
                  <p>TODO: SNV, INS, DELのサマリー（まずはカウント）を表示する．</p>
                  <p>TODO: known reported mutaion associate with disease的なものを表示する？</p>
                  <p>TODO: dbNSFPをからめる．</p>
                  <hr>

                  {{ pdb_name }}

                  <hr>
                  <span class="badge badge-yellow"><a href="//www.rcsb.org/pdb/explore/explore.do?structureId={{ pdb_name }}" target="_blank">PDB</a></span>
                  <hr>
                  <p>3D structure:</p>
                  <canvas class="ChemDoodleWebComponent" id="mg" width="256" height="256">This browser does not support HTML5/Canvas.</canvas>
                  <p>TODO: If WebGL is no enabled, <a href="{% url apps.faq.views.index %}#safari_webgl">[FAQ] Safari: Enable WebGL in Safari.</a></p>
                  <p>TODO: enable to highlight mutation</p>


                  <hr>
                  <span class="rcsb" title="Go to RCSB PDB-101"><a href="//www.rcsb.org/pdb/101/motm.do?momID=156" target="_blank"><button class="btn btn-info">Learn more about ABO Blood Type Glycosyltransferases</button></a></span>

                  <button class="btn btn-info" href="#" onclick="hideIntronsAndUTRs();return false;">Hide Introns and UTRs</button>
                  <button class="btn btn-success" href="#" onclick="location.reload();return false;">Refresh</button>

                  <hr>

                  <table>
                    <tbody>
                      <tr>
                        <td>
                        <a href="//www.ncbi.nlm.nih.gov/gene?term={{ gene_info.gene_id }}" target="_blank">{{ gene_info.gene }}</a>
                        </td>
                      </tr>

                      {% for k,v in gene_info.items %}
                      <tr>
                        <td>
                          {{ k }}:
                        </td>
                        <td>
                          {% if k == 'classed_seq' %}
                          {% spaceless %}
                          <pre class="genome">
                            {% for sub_seq in v %}
                            <span class="{{ sub_seq.1 }}">{{ sub_seq.0 }}</span>
                            {% endfor %}
                          </pre>
                          {% endspaceless %}
                          {% elif k == 'seq' %}

                          {% else %}
                          {{ v }}
                          {% endif %}
                        </td>
                      </tr>
                      {% endfor %}
                      </tbody>
                  </table>

                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript">
  var hideIntronsAndUTRs = function () {
	  var introns = $(".intron");
      $.each(introns, function () {$(this).remove();});

      var utrs = $(".utr");
      $.each(utrs, function () {$(this).remove();});
  };


  $(document).ready(function () {
      var orig;
      $(".genome").children().hover(
          function () {
              orig = $(this).css("color");
              $(this).css("color", "red");
          },
          function () {
              $(this).css("color", orig);
          }
      );

      //
      $(".genome").children().tooltip({title: "hello"});
  });
</script>

<script type="text/javascript">$('.rcsb').tooltip();</script>

<link rel="stylesheet" href="{% static 'css/ChemDoodleWeb.css' %}" type="text/css">
<script type="text/javascript" src="{% static 'js/chemdoodle/ChemDoodleWeb-libs.js' %}"></script>
<script type="text/javascript" src="{% static 'js/chemdoodle/ChemDoodleWeb.js' %}"></script>


<script>
  var pdb_{{ pdb_name }}  = {% for r in pdb_records %}"{{ r }}" +
                            {% endfor %}"END";

  var mg = new ChemDoodle.TransformCanvas3D('mg', 256, 256);
  mg.specs.set3DRepresentation('Stick');
  mg.specs.atoms_display = false;
  mg.specs.bonds_display = false;
  mg.specs.ribbons_useShapelyColors = false;
  mg.specs.ribbons_useAminoColors = false;
  mg.specs.ribbons_cartoonize = true;
  var struct = ChemDoodle.readPDB(pdb_{{ pdb_name }});
  mg.loadMolecule(struct);
</script>

{% endblock %}
