{% extends "layout.html" %}
{% block title %}Risk report{% endblock %}
{% block description %}risk report{% endblock %}
{% block cookie_id %}risk_report{% endblock %}
{% load staticfiles %}
{% load extras %}
{% load add_get_parameter %}

{% block main_container %}
<div id="main_container" class="span14">
  <section id="main">

    <div class="container">

      <!-- alerts -->
      {% if msg %}
      <div class="alert alert-info">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>Information:</strong> {{ msg }}
      </div>
      {% endif %}

      {% if err %}
      <div class="alert alert-error">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>Error!</strong> {{ err }}
      </div>
      {% endif %}



      {% if not err %}
      <!-- Breadcrumb -->
      <div class="row-fluid">
        <div class="span12">
          <ul class="breadcrumb">
            <li><a href="{% url apps.riskreport.views.index %}">Risk report</a><span class="divider">/</span></li>
            <li class="active">Show All and Comparison</li>
          </ul>

          <div class="content-box transparent">
            <div class="padded10">
              <h4>Show All and Comparison</h4>
              <ul>
                <li><a href="{% url apps.faq.views.index%}">[FAQ] What is RR (Relative Risk)?</a></li>
                <li><a href="{% url apps.faq.views.index%}">[FAQ] How are risk values calculated?</a></li>
              </ul>

            </div>
          </div>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span12">
          <div class="padded">
            <div class="content-box">
              <div class="content-box-header" data-step="1" data-intro="All the disease risk values are listed in this chart." data-position='top'>
                <icon class="icon-exclamation-sign"></icon>Disease Risk (Show All and Comparison)
              </div>

              <div class="padded">
                <div class="row-fluid">
                  <div class="span12">


                    <form action="{% url apps.riskreport.views.show_all %}" method="post" enctype="multipart/form-data">
                      {% csrf_token %}
		              <fieldset data-step="2" data-intro="You can change genome files from here.">
                        <b>Compare</b>
                        <select name="file_name" onchange="submit(this.form)" class="file_name" title="change genome file?" >
                          {% for info in infos %}
                          {% if info == tmp_infos.0 %}
                          <option value="{{ info.name }}" selected>{{ info.name }}</option>
                          {% else%}
                          <option value="{{ info.name }}">{{ info.name }}</option>
                          {% endif %}
                          {% endfor%}
                        </select>

                          <b>with </b>
                        <select name="file_name2" onchange="submit(this.form)" class="file_name2" title="change genome file?" data-step="3" data-intro="And also you can compare the risk values with another genome file by selecting one from here.">
                          <option value="-" selected>-</option>
                          {% for info in infos %}
                          {% if info == tmp_infos.1 %}
                          <option value="{{ info.name }}" selected>{{ info.name }}</option>
                          {% elif info == tmp_infos.0 %}

                          {% else %}
                          <option value="{{ info.name }}">{{ info.name }}</option>
                          {% endif %}
                          {% endfor%}
                        </select>

                      </fieldset>
                    </form>

                    <div id="container" style="min-width: 200px; height: 2500px; margin: 0 auto"></div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- <div class="row-fluid"> -->
        <!--   <div class="span12"> -->
        <!--     <div class="padded"> -->

        <!--       <table cellpadding="0" cellspacing="0" border="0" class="display datatable" id="risk_reports_table"> -->
        <!--         <thead> -->
        <!--           <tr> -->
        <!--             <th>Trait</th> -->
        <!--             <th>Value</th> -->
        <!--           </tr> -->
        <!--         </thead> -->

        <!--         <tbody> -->
        <!--           {% for trait_name,value in risk_reports.items %} -->

        <!--           <tr> -->
        <!--             <td class="center"><a href="{% url apps.riskreport.views.study trait=trait_name|urlencode %}">{{ trait_name }}</a></td> -->
        <!--             <td class="center">{{ value }}</td> -->
		<!--           </tr> -->
		<!--           {% endfor %} -->
        <!--         </tbody> -->
        <!--       </table> -->
        <!--     </div> -->
        <!--   </div> -->
        <!-- </div> -->
        {% endif %}

      </div>
    </div>
</div>
{% endblock %}

{% block js %}

<script type="text/javascript" src="{% static 'js/highcharts/highcharts.js' %}"></script>
<script type="text/javascript" src="{% static 'js/highcharts/modules/exporting.js' %}"></script>


<script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                type: 'bar'
            },
            title: {
                text: 'Risk relative to average population'
            },
            xAxis: {
                categories: [{% for trait in risk_traits %}
                             {% if trait|length|get_digit:'-1' < 20 %}"{% autoescape off %}{{ trait }}{% endautoescape %}"
                             {% else%}"{% autoescape off %}{{ trait|slice:'20' }}...{% endautoescape %}"
                             {% endif %},
                             {% endfor %}],
                title: {
                    text: null
                }
            },
            yAxis: {
                max: 10,
                min: -10,
                title: {
                    text: '[RR]',
                    align: 'high'
                }
            },
            tooltip: {
                formatter: function() {
                    return ''+
                        this.x + ': x' + ((this.y == 0.0) ? 1.0 : this.y);
                }
            },
            plotOptions: {
            series: {
                shadow:true,
                cursor:'pointer',
                    point: {
                        events: {
                            click: function() {
                                location.href = this.options.url;
                                <!-- window.open(this.options.url); -->
                            }
                        }
                    }
                },
                bar: {
                    dataLabels: {
                        enabled: false
                    }
                }
            },
            credits: {
                enabled: false
            },

            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'top',
                x: -50,
                y: 50,
                floating: true,
                borderWidth: 1,
                backgroundColor: '#FFFFFF',
                shadow: true,
                enabled: false
            },

            series: [
                    {% if tmp_infos|length > 1 %}
                    {
                    name: '{ tmp_infos.1.name }}',
                    data: [{% for risk_value in risk_values.1 %}
                             {y: {% ifnotequal risk_value|abs 1.0 %}{{ risk_value }}{% else %}0.0{% endifnotequal %},
                              color: {% if risk_value < 0 %}'#2cf177'{% elif risk_value == 0 %}'#8a8a8a'{% else %}'#f1772c'{% endif %},
                              url:"{% url apps.riskreport.views.study trait=risk_traits|listvalue:forloop.counter0|urlencode study=risk_studies.1|listvalue:forloop.counter0|urlencode %}?file_name={{ tmp_infos.1.name }}"},
                           {% endfor %}],
                    },
                    {
                    name: '{{ tmp_infos.0.name }}',
                    data: [{% for risk_value in risk_values.0 %}
                             {y: {% ifnotequal risk_value|abs 1.0 %}{{ risk_value }}{% else %}0.0{% endifnotequal %},
                              color: {% if risk_value < 0 %}'#2ca6f1'{% elif risk_value == 0 %}'#8a8a8a'{% else %}'#f12ca6'{% endif %},
                              url:"{% url apps.riskreport.views.study trait=risk_traits|listvalue:forloop.counter0|urlencode study=risk_studies.0|listvalue:forloop.counter0|urlencode %}?file_name={{ tmp_infos.0.name }}"},
                           {% endfor %}],
                    },


                    {% else %}
                    {
                    name: '{{ tmp_infos.0.name }}',
                    data: [{% for risk_value in risk_values.0 %}
                             {y: {% ifnotequal risk_value|abs 1.0 %}{{ risk_value }}{% else %}0.0{% endifnotequal %},
                              color: {% if risk_value < 0 %}'#2ca6f1'{% elif risk_value == 0 %}'#8a8a8a'{% else %}'#f12ca6'{% endif %},
                              url:"{% url apps.riskreport.views.study trait=risk_traits|listvalue:forloop.counter0|urlencode study=risk_studies.0|listvalue:forloop.counter0|urlencode %}?file_name={{ tmp_infos.0.name }}"},
                           {% endfor %}],
                    },
                    {% endif %}
            ]
        });
    });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  $('#risk_reports_table').dataTable({
    "bJQueryUI": true,
    "sPaginationType": "full_numbers",
    "iDisplayLength": 25,
    "aLengthMenu": [ 25, 50, -1 ]
  });
});
</script>

<link href="{% static 'css/introjs.css' %}" rel="stylesheet">
<script type="text/javascript" src="{% static 'js/intro.js' %}"></script>
{% if do_intro %}<script type="text/javascript">introJs().start()</script>{% endif %}

<script type="text/javascript">$('select.file_name').tooltip();</script>
<script type="text/javascript">$('select.file_name2').tooltip();</script>
{% endblock %}
