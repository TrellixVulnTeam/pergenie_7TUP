{% extends "layout.html" %}
{% block title %}Risk report - {{ study_name }}{% endblock %}
{% block description %}risk report detail{% endblock %}
<!-- {% block cookie_id %}risk_report_detail{% endblock %} -->
{% load staticfiles %}
{% load extras %}

{% block main_container %}
<div id="main_container" class="span12">
  <section id="main">

    <div class="container">

      <!-- Breadcrumb -->
      <div class="row-fluid">
        <div class="span12">
          <ul class="breadcrumb">
            <li><a href="{% url apps.riskreport.views.index %}">Risk report</a><span class="divider">/</span></li>
            <li class="active">{{ file_name }}<span class="divider">/</span></li>
            <li class="active">{{ trait_name }}<span class="divider">/</span></li>
            <li class="active">{{ study_name }}</li>
          </ul>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span12">
          <div class="content-box">
            <div class="padded">
              <h3>{{ trait_name }}{% if is_ja %} ({{ trait_eng }}){% endif %}</h3>
              {% if wiki_url_en %}<span class="badge badge-yellow"><a href="{{ wiki_url_en }}" target="_blank">Wikipedia</a></span>{% endif %}
            </div>
          </div>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span4">
          <div class="content-box">

            <div class="content-box-header">
              <i class="icon-bar-chart"></i> Effects of SNPs
            </div>

            <!-- <div id="container" style="max-width: 400px; height: 300px; margin: 0 auto"></div> -->
            <div id="container"> <!-- style="max-width: 400px; height: 300px; margin: 0 auto"></div> -->
            </div>
          </div>
        </div>

        <div class="span8">
          <div class="content-box">
            <div class="content-box-header">
              <i class="icon-book"></i> Reference study
            </div>

            <div class="row-fluid">
              <div class="span12">
                <h4>"{{ study_name }}"</h4>
              </div>
            </div>

            <a href="{% url apps.riskreport.views.trait trait=trait_name file_name=file_name %}"><button class="btn btn-green"><i class="icon-book icon-white" style="margin-top: 1px;"></i> Other studies</button></a>
          </div>
        </div>


      </div>

      <div class="row-fluid">
        <div class="span12">
          <!-- <div class="content-box"> -->

            <table cellpadding="0" cellspacing="0" border="0" class="display datatable" id="risk_reports_table">
              <thead>
                <tr>
                  <th>RR (Risk relative to average population) [log10]</th>
                  <th>RR [real]</th>
                  <th>SNPs</th>
                  <th>Genotype</th>
                  <th>Risk allele</th>
                  <th>Risk allele frequency</th>
                  <th>OR</th>
                </tr>
              </thead>

              <tbody>
                {% for snp, store in tmp_risk_store.items %}
                <tr>
                  <td class="center">{{ store.RR }}</td>
                  <td class="center">{{ store.RR_real }}</td>
                  <td class="center">rs{{ snp }}</td>
                  <td class="center">{% if store.variant_map.0 in store.catalog_map.risk_allele %}
                    <span>{{ store.variant_map.0 }}</span>
                    {% else %}
                    <span style="color : #c5c5c5">{{ store.variant_map.0 }}</span>
                    {% endif %}
                    {% if store.variant_map.1 in store.catalog_map.risk_allele %}
                    <span>{{ store.variant_map.1 }}</span>
                    {% else %}
                    <span style="color : #c5c5c5">{{ store.variant_map.1 }}</span>
                    {% endif %}
                  </td>
                  <td class="center">{{ store.catalog_map.risk_allele }}</td>
                  <td class="center">{{ store.catalog_map.risk_allele_frequency }}</td>
                  <td class="center">{{ store.catalog_map.OR }}</td>
		        </tr>
		        {% endfor %}
              </tbody>
            </table>

          <!-- </div> -->
        </div>
      </div>
    </div>

  </section>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                type: 'column'
            },
            title: {
                text: ''
            },
            xAxis: {
                categories: [{% for snp in snps_list %}"rs{{ snp }}",{% endfor %}],
                labels: {
                    rotation: -45,
                    align: 'right',
                }
            },
            yAxis: {
                max: 1.0,
                min: -1.0,
                title: {
                    text: 'Risk relative to average population'
                }
            },

            tooltip: {
                formatter: function() {
                    return '<b>'+ this.x +'</b><br/>'+
                        'Risk value: '+ Highcharts.numberFormat(this.y, 3) + '[log10] <br/>' ;
                }
            },
            credits: {
                enabled: false
            },
            exporting: {
                enabled: false
            },
            legend: {
                enabled: false
            },
            series: [{
                name: "{{ file_name }}",
                data: [{% for RR_value in RR_list %}
                         {y: {{ RR_value }},
                          color: {% if RR_value < 0 %}'#2ca6f1'{% elif RR_value == 0 %}'#8a8a8a'{% else %}'#f12ca6'{% endif %},
                          },
                       {% endfor %}],
                },
            ]


        });
    });

});
</script>

<script type="text/javascript" src="{% static 'js/highcharts/highcharts.js' %}"></script>
<script type="text/javascript" src="{% static 'js/highcharts/modules/exporting.js' %}"></script>

<script type="text/javascript">
$(document).ready(function(){
  $('#risk_reports_table').dataTable({
    "bJQueryUI": true,
    "sPaginationType": "full_numbers",
    "iDisplayLength": 25,
    "aLengthMenu": [ 25, 50, -1 ]
  });
});
</script>

{% endblock %}
